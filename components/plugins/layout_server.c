/*
 * layout_server.c
 *
 *  Created on: 21 Apr 2019
 *      Author: gal
 */

#include "layout_server.h"

#include "freertos/FreeRTOS.h"
#include "esp_wifi.h"
#include "esp_system.h"
#include "esp_event.h"
#include "esp_log.h"
#include "nvs_flash.h"
#include "driver/gpio.h"
#include "freertos/portmacro.h"
#include "freertos/event_groups.h"
#include "esp_log.h"
#include "esp_netif.h"

#include "lwip/err.h"
#include "string.h"

#include "cJSON.h"
#include "ping.h"
#define LAYOUT_TAG "Layout server"

#define delay(ms) (vTaskDelay(ms/portTICK_RATE_MS))
char* json_unformatted;

const static char http_html_hdr[] =
    "HTTP/1.1 200 OK\r\nContent-type: text/html\r\n\r\n";
const static char http_index_hml[] = "<!DOCTYPE html>"
      "<html>\n"
      "<head>\n"
      "  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n"
      "  <style type=\"text/css\">\n"
      "    html, body, iframe { margin: 0; padding: 0; height: 100%; }\n"
      "    iframe { display: block; width: 100%; border: none; }\n"
      "  </style>\n"
      "<title>HELLO ESP32</title>\n"
      "</head>\n"
      "<body>\n"
      "<h1>Hello World, Ahuyama its here!</h1>\n"
      "<div><img alt=\"logo\" class=\"full-h\" src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDIwMDEwOTA0Ly9FTiIKICJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy1TVkctMjAwMTA5MDQvRFREL3N2ZzEwLmR0ZCI+CjxzdmcgdmVyc2lvbj0iMS4wIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiB3aWR0aD0iNTY0LjAwMDAwMHB0IiBoZWlnaHQ9IjczMi4wMDAwMDBwdCIgdmlld0JveD0iMCAwIDU2NC4wMDAwMDAgNzMyLjAwMDAwMCIKIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIG1lZXQiPgo8bWV0YWRhdGE+CkNyZWF0ZWQgYnkgcG90cmFjZSAxLjE2LCB3cml0dGVuIGJ5IFBldGVyIFNlbGluZ2VyIDIwMDEtMjAxOQo8L21ldGFkYXRhPgo8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjAwMDAwMCw3MzIuMDAwMDAwKSBzY2FsZSgwLjEwMDAwMCwtMC4xMDAwMDApIgpmaWxsPSIjMDAwMDAwIiBzdHJva2U9Im5vbmUiPgo8cGF0aCBkPSJNMjA1IDcyODEgYy01NSAtMTQgLTk1IC00MSAtMTIzIC04MyBsLTI3IC00MiAtMyAtMTYwMyAtMiAtMTYwMiA0MwotOTMgYzU4IC0xMjMgMTI0IC0zMTUgMTQ0IC00MTggMzEgLTE2MiAzNyAtMzcwIDEzIC00NjAgLTcgLTI1IC0xMyAtNTIgLTE1Ci02MCAtMTMgLTY1IC05OSAtMjEzIC0xNTQgLTI2NCBsLTMxIC0zMCAwIC03MzkgMCAtNzM4IDQyIC0xMDIgYzEyNSAtMzA3IDMxNwotNTYyIDUzOCAtNzEzIDk2IC02NiAyNTEgLTEzMSAzNzUgLTE1NyA4OCAtMTkgMjU5IC0zMCAzMDUgLTE5IGwzNSA4IC02MCAxOApjLTkyIDI4IC0yNjUgMTE3IC0zNTcgMTg0IC04NCA2MSAtMjE0IDE4OCAtMjU4IDI1MiAtMTMgMTkgLTI3IDM3IC0zMCA0MCAtMjMKMjIgLTEyNCAyMjUgLTE0OCAzMDAgLTQ4IDE1MCAtNTcgMjA5IC01NyAzODAgMCAxMjcgNCAxODMgMTkgMjQ1IDU5IDI1MCAxNjYKNDU1IDMxOCA2MDggMzkgMzkgNjggNzYgNjggODggMCAzMSAxNyA1NyA0OCA3MyAyMyAxMiAzMiAxMiA1MSAxIDIxIC0xMSAzMwotOCAxMDYgMjYgMTMwIDYxIDI1NyA5MCA0MTIgOTUgMTg2IDYgMzAxIC0yMCA0NjUgLTEwMiBsODcgLTQ0IDM0IDIwIDM0IDIwCjM0IC0yMyBjMzEgLTIxIDM0IC0yNyAzNCAtNzMgMCAtNDYgNCAtNTMgNTAgLTk5IDk5IC0xMDAgMTM1IC0xNDMgMTUxIC0xODEgOQotMjIgMjIgLTUyIDI5IC02OSA4IC0xNiAyMyAtNjEgMzQgLTk5IDI3IC05MyAyNCAtMjgyIC02IC0zNzEgLTQzIC0xMjUgLTExMQotMjIxIC0xOTggLTI3OSAtNDAgLTI3IC01NSAtNDMgLTU1IC02MCAwIC0yOSAtMzkgLTY2IC03MSAtNjYgLTEzIDAgLTM2IDgKLTUyIDE4IC0yMyAxNiAtMzcgMTcgLTkwIDEwIC0zNCAtNSAtNzMgLTYgLTg3IC00IC0xNCAzIC00NSA4IC03MCAxMSAtNzUgMTEKLTE2MCA1OCAtMjI0IDEyNSBsLTU3IDYwIC02MCAwIC01OSAwIDAgMTI0IDAgMTI1IDQ3IDMgYzM3IDIgNDggNyA1MyAyMyAxNgo1OSA3NSAxMTcgMTQ4IDE0NSA4OCAzNCAxNzUgMjEgMjAyIC0zMCAxOSAtMzUgMTYgLTk3IC00IC0xMTkgLTE5IC0yMSAtMTkKLTIxIDM3IC0yMSA1MCAwIDU3IC0yIDU3IC0yMCAwIC0xMSAzIC0xOSA4IC0xOSAyMSA0IDMzIC0zIDQxIC0yMyAxMCAtMjcgLTMKLTQ4IC0zMCAtNDggLTE0IDAgLTE5IC03IC0xOSAtMjUgMCAtMzUgMTYgLTMxIDYwIDEyIDc4IDgwIDExMyAyNjIgNzEgMzczCi0yOCA3NCAtODggMTUyIC0xMjUgMTYxIC0xNiA1IC0zOSAyMCAtNTAgMzQgLTQxIDQ5IC0yMTUgODkgLTMzMSA3NSAtMTE0IC0xNAotMTI4IC0xOSAtMTIyIC00NyAzIC0xNiAtMiAtMzIgLTE0IC00NCAtMjQgLTI0IC00NCAtMjQgLTY3IC0xIC0xNiAxNyAtMTggMTcKLTUyIC0yIC0xMjkgLTczIC0yMjAgLTE5NSAtMjQ1IC0zMjkgbC03IC0zNyAzNiAwIGMyMiAwIDM1IC00IDMxIC0xMCAtMyAtNQotMTkgLTEwIC0zNiAtMTAgLTIyIDAgLTI5IC01IC0yOSAtMjAgMCAtMTcgNyAtMjAgNTEgLTIwIDMxIDAgNDggLTQgNDQgLTEwCi0zIC01IC0yIC0xMCAzIC0xMCA2IDAgMTMgNyAxNiAxNiA4IDIwIDQ1IDE1IDYwIC04IDIzIC0zNyAtMjcgLTc0IC01OCAtNDMKLTkgOSAtMTYgMTIgLTE2IDYgMCAtNiAtMTkgLTExIC00NCAtMTEgLTQxIDAgLTQ1IDIgLTUwIDI4IC0yIDE1IC0zIC0xMCAtMQotNTUgMiAtNDUgNiAtODYgMTAgLTkyIDMgLTYgMjQgLTExIDQ2IC0xMSAzNyAwIDM5IC0yIDM5IC0zMCAwIC0yNyAtMyAtMzAKLTMwIC0zMCAtMzAgMCAtNDIgLTIxIC0yMCAtMzUgNiAtMyAxMCAtMTMgMTAgLTIwIDAgLTMxIDY3IC0xNTcgMTEyIC0yMDkgNAotNiAxNiAwIDI2IDEyIDQ5IDU2IDEzMiAyNSAxMzIgLTQ5IDAgLTMzIC01IC00MiAtMzAgLTU4IC0yOCAtMTcgLTI5IC0xOSAtMTQKLTMyIDEwIC04IDI1IC0xMyAzNSAtMTEgMjcgNSA1OSAtMTYgNTkgLTM5IDAgLTExIDggLTIzIDE4IC0yNiA5IC00IDE5IC05IDIyCi0xMiAyNyAtMzEgMjA1IC04NiAzMjcgLTEwMSAxMDMgLTEyIDIxMyAtNSAzMTYgMjEgbDM3IDEwIC0xNSAyOSBjLTggMTYgLTE1CjQ3IC0xNSA2OCAwIDgzIDEwOCAxMzEgMTg3IDgzIDE4IC0xMSAzNyAtMzUgNDQgLTU0IGwxMiAtMzUgNDAgMjUgYzIyIDE0IDUwCjM0IDYxIDQ0IDIwIDE5IDIwIDE5IC02IDE5IC0zMiAwIC02OCA0MSAtNjggNzcgMCAzMSA0MiA3MyA3MyA3MyAzNCAwIDc3IC0zNgo3NyAtNjYgMCAtMTMgMyAtMjQgNiAtMjQgMTcgMCAxMzYgMTQwIDIwNyAyNDMgbDQ2IDY3IC0xMjQgMCAtMTI1IDAgMCAxMjUgMAoxMjUgMTI4IDEgYzEyOCAxIDE0MCAxIDE4MyAxNCAxOSA1IDIxIDQgOSAtNCAtMTIgLTkgLTEwIC0xMSAxMSAtMTEgMTkgMCAyOQo2IDMzIDIzIDI3IDkzIDI4IDI3MyAyIDM3MiAtMjggMTA3IC05OSAyMzkgLTE3MCAzMTkgLTE0IDE2IC0yNiAzMyAtMjYgMzcgMAo4IC0xMDIgNzkgLTExNCA3OSAtNyAwIC0xNjMgODcgLTE4MCAxMDEgLTEzNSAxMDggLTIzMCAyMTAgLTI3MCAyODggLTM3IDcwCi02NyAxNjYgLTcyIDIyNSAtMTAgMTIyIC0xMiAxMjcgLTQyIDExOSAtNzggLTIyIC0xODAgMSAtMjU2IDU5IC0zOSAzMCAtMjY0CjI1NyAtMzE2IDMxOSAtMTQgMTcgLTMyIDM4IC00MSA0NyAtOSA5IC0zNSA0MyAtNTkgNzUgLTIzIDMxIC00NiA1NyAtNTEgNTcKLTUgMCAtMTYgMTcgLTI0IDM3IC05IDIxIC0xOSA0MCAtMjQgNDMgLTQgMyAtMjkgMzYgLTU0IDc1IGwtNDcgNzAgMCAtNDggYzAKLTI2IC00IC00NyAtMTAgLTQ3IC01IDAgLTEwIDQgLTEwIDkgMCA2IC0xOCA5IC00MCA4IC00NiAtMSAtNjUgMTIgLTU1IDQyIDUKMTUgMTUgMjEgMzggMjEgMjggMSAzMCAyIDEzIDEyIC0xMiA2IC05OCAxMiAtMjE5IDE1IC0xMTEgMiAtMjAzIDYgLTIwNiA4Ci0xMSAxMSAxMSAxNCAxNDIgMTYgNzYgMiAxNDEgNyAxNDMgMTEgMyA0IDEzIDQgMjIgMCAyNiAtMTMgMTQyIC0xNSAxNDIgLTMgMAoxNSAtMTI4IDIyNCAtMTUyIDI0NyAtNyA3IC03NCAyMiAtMTQ4IDM0IC0zMTIgNTEgLTM1MCA1OSAtNDAzIDgzIC05NiA0NAotMTAyIDU5IC0xNDcgMzg3IC01IDM2IC0zMCAyMDUgLTU0IDM3NSAtMjUgMTcxIC00NyAzMjYgLTUwIDM0NSAtMTcgMTM2IC0xOAoxNDAgLTM3IDE0MCAtMzUgMCAtNDkgMjggLTQ5IDk2IDAgNTkgMiA2NSAyNSA3NiAxNCA2IDI1IDIwIDI1IDMxIDAgMzUgNDAgODUKODYgMTA3IDY4IDMzIDExMSAyOCA1MzkgLTY2IDExIC0yIDU2IC0xMSAxMDAgLTIwIDQ0IC05IDEwMCAtMjAgMTI1IC0yNiAyNQotNSA1NCAtMTEgNjUgLTE0IDE0OSAtMzEgMzI3IC02OCAzOTUgLTgwIDQ3IC05IDEwNSAtMjIgMTMwIC0zMCAzNyAtMTEgNDcKLTExIDU4IDAgMTEgMTEgOCAxNCAtMjAgMjAgbC0zMyA4IDY1IDMxIGM1MyAyNiA3NCA0NCAxMTMgOTcgMjYgMzYgNjggOTEgOTMKMTIzIDc2IDk4IDExMCA2OCA4MCAtNzEgbC0xNyAtNzYgMjIgLTE3IGMyMiAtMTcgMjMgLTE2IDU1IDM2IDgyIDEzNyAxNTEgMjAzCjE2NyAxNjEgNiAtMTUgLTM5IC05NCAtNzcgLTEzNCBsLTIxIC0yNCA0NiA3IGM0MSA2IDQ4IDQgNjIgLTE1IGwxNSAtMjEgNiAyNgpjNSAyMCAxMiAyNiAyOSAyMyAyMyAtMyAyOCAtMzIgMTMgLTczIC05IC0yMiA0NyAzMSA3NyA3NSAxNiAyMyAxOCAyMyAzMyA4CjE2IC0xNiAxNiAtMjAgLTMgLTY1IC0xMSAtMjYgLTI0IC02NSAtMjcgLTg2IC04IC00MSAtMjQgLTQ1IC00MCAtMTAgLTEwIDIwCi0xMSAyMCAtNDggLTEwIC0zMSAtMjUgLTQzIC0yOSAtNTYgLTIxIC0yMSAxMyAtMjcgNTYgLTEyIDg0IDYgMTEgOCAyMCA2IDIwCi0xMSAwIC0zNiAtNjAgLTM2IC04NSAwIC0xNCAtMyAtMjUgLTcgLTI1IC0yNSAxIC01OCA1MyAtNDkgNzcgNSAxMyAxIDE0IC0yNgo5IC0xOCAtMyAtMzcgLTEzIC00MyAtMjIgLTI3IC00NCAtNDQgLTU5IC01NSAtNDggLTcgNyAtOCAxOSAtMSAzNyA5IDIzIDggMjcKLTcgMjcgLTIyIDAgLTM0IC05IC01NSAtNDIgLTIyIC0zNSAtMzcgLTM2IC0zNyAtMiAwIDI0IC0xIDI1IC00NyAxOCAtMzYgLTUKLTU5IC0xNyAtOTQgLTQ4IC0yOSAtMjUgLTQ1IC00NyAtNDIgLTU2IDcgLTIxIDkgLTQwIDIyIC0xNTUgNyAtNTUgMTYgLTEzMQoyMSAtMTcwIDUgLTM4IDEyIC04OCAxNCAtMTEwIDMgLTIyIDEwIC03OCAxNiAtMTI1IGwxMSAtODUgNDIgLTI1IGMyMyAtMTQgNDYKLTI3IDUxIC0yOSA1IC0yIDU4IC0zNyAxMTggLTc3IDYwIC00MSAxMjAgLTc0IDEzMyAtNzQgMTQgMCAzMyAtMTIgNDkgLTMyIDE0Ci0xOCAzMCAtMzcgMzQgLTQxIDQgLTUgNTIgLTQxIDEwNyAtODIgbDEwMCAtNzMgMTIgMjggYzIxIDUxIDcyIDY0IDExNyAyOSAzOQotMzAgMzcgLTkwIC00IC0xMjAgLTM3IC0yOCAtMjUgLTUwIDI0IC00MiAyNyA0IDM2IDEgNDkgLTE4IDkgLTEyIDE0IC0zMiAxMgotNDMgLTQgLTE2IDE3IC00NSA4MSAtMTE2IDQ3IC01MiA5NSAtMTEyIDEwNiAtMTM0IDI1IC00OSAzNSAtMTUyIDE5IC0xOTcgLTYKLTE4IC05IC0zNCAtNyAtMzYgMiAtMiA0OCAtMTAgMTAyIC0xOCA1NSAtNyAxMjQgLTIzIDE1NCAtMzUgNzkgLTMxIDE4NSAtMTA0CjI1NSAtMTc0IDY1IC02NiAxNjIgLTIwMyAxOTQgLTI3NyA1NSAtMTI0IDE3MiAtMTU2IDI0NCAtNjYgMzMgNDAgMTc3IDMyMgoxNzcgMzQ2IDAgNyAtMzUgMTEgLTEwNSAxMSAtMTA1IDAgLTEwNSAwIC0xMDUgMjQgMCAxOSAtNiAyNSAtMjcgMjggLTIyIDIKLTI5IDkgLTMxIDMwIC0zIDI4IDI4IDU1IDQ4IDQzIDYgLTQgMTAgMTkgMTAgNTkgbDAgNjYgMTgzIDAgMTgzIDAgNTMgNzQgYzUxCjcxIDI4NCAzMTYgMzAxIDMxNiA0IDAgOCAyMyA4IDUxIDEgNDQgNiA1NyAzMyA4NSAzNiAzNyA4MSA0OSAxMjYgMzMgMjcgLTkKMzYgLTcgNzIgMTggMjIgMTUgNDAgMzYgNDEgNDYgMCAxMCAxMiAyOSAyNiA0NCAyMSAyMSAzMSAyNCA2MyAxOSAzMiAtNSA1NCAxCjEyNSAzNSAxNjcgNzggMzI1IDExMiA1MTcgMTExIDU4IC0xIDExMiAtMiAxMjAgLTQgMTIgLTIgMTQgMzIgMTcgMTk3IGwyIDIwMAotMzIgMTQgYy0xOCA3IC04OSAzMyAtMTU4IDU4IC0xMDMgMzggLTEzNiA0NSAtMTg3IDQ0IC00OSAtMSAtNjMgMiAtNjMgMTMgMAo4IC0xMyAxOSAtMjkgMjQgLTI3IDkgLTMwIDggLTMzIC0xMSAtMiAtMTggLTExIC0yMyAtNDUgLTI1IC00NCAtMyAtNDkgMyAtNDQKNDUgMiAxOCAtNyAyMSAtMTQwIDM4IC0yNTYgMzQgLTUxOSAyNiAtNzAyIC0yMiAtNTkgLTE1IC02OCAtMjAgLTYzIC0zNyA4Ci0zMSAtMTEgLTU2IC00NSAtNTYgLTE3IDAgLTMyIDYgLTM1IDE1IC00IDggLTkgMTUgLTEzIDE1IC00IDAgLTQ4IC0yNiAtOTcKLTU5IC0xNTUgLTEwMiAtMjI2IC0xMjIgLTQ0OSAtMTI2IC0xMzQgLTMgLTE5MSAwIC0yNzAgMTQgLTEzOCAyNSAtMzAwIDcyCi00MDAgMTE1IC0xNiA3IC00NSAxOSAtNjIgMjYgLTE4IDcgLTMzIDE2IC0zMyAyMCAwIDQgMzcgNDcgODMgOTUgMTAzIDExMQoyODIgMjYwIDM3NSAzMTMgMTcgMTAgMjEgMTggMTYgMzUgLTkgMzEgLTggMzEgLTU1IC0yIGwtNDIgLTMxIC0yNCAyMiBjLTM5CjM2IC0zMSA4MCAyMyAxMzQgNDIgNDIgNDkgNDYgODQgNDEgMzIgLTQgMzkgLTIgNDMgMTUgNCAxMyAxMiAxOSAyOCAxNiAzOCAtNQo0NSAtMzAgMjUgLTk1IC05IC0zMiAtMjAgLTY2IC0yMiAtNzUgLTQgLTE0IDUgLTEzIDU2IDEwIDUyIDIzIDYwIDMwIDYwIDU0IDAKMTcgOCAzMSAyMCAzOCAxNyA5IDI0IDYgNDMgLTEzIDE4IC0yMCAyNiAtMjMgNDcgLTE1IDg4IDM0IDI2MSA0NiAzOTUgMjcgNzAKLTkgMjAzIC01MSAyNTcgLTgwIDMwIC0xNiA3MjggLTE5IDcyOCAtMyAwIDE5IDM2IDQ0IDYzIDQ0IDI3IDAgNTcgLTMyIDU3Ci02MSAwIC0xMyAyMSAtMjAgMTA4IC0zMyAxNDQgLTIyIDQwMyAtODkgNTE4IC0xMzMgMTMgLTUgMTQgOTYgMTIgODMzIGwtMwo4MzkgLTI1IDQzIGMtMTUgMjcgLTQyIDU0IC03MCA3MCBsLTQ1IDI3IC0zOTIgMyBjLTM5MSAzIC0zOTIgMyAtNDAzIC0xOCAtNwotMTQgLTEwIC02NSAtOSAtMTM4IGwzIC0xMTcgLTExMiAtMyAtMTEyIC0zIDAgOTAgYzAgODggMSA5MSAyNSA5NyAxMyAzIDMwIDQKMzcgMSAyOCAtMTAgNDggMTMgNDggNTMgbDAgNDAgLTEwMzkgMCBjLTY4NCAwIC0xMDQ5IC00IC0xMDY5IC0xMSAtNDcgLTE2Ci01MiAtNDEgLTUyIC0yNTkgbDAgLTIwMCAtNzc0IDAgLTc3NSAwIC0zIDIxMCBjLTMgMjAzIC00IDIxMCAtMjYgMjMyIC0yMiAyMwotMjcgMjMgLTI4MCAyNSAtMTQxIDEgLTI3MCAtMiAtMjg3IC02eiBtNTIzMiAtOTcgYzM1IC0yMiA1NSAtNzAgNDggLTExNCAtMTcKLTk5IC0xNDMgLTEyNiAtMjAwIC00MiAtNDQgNjUgLTI3IDEzMyA0MCAxNjMgNDIgMTkgNzQgMTcgMTEyIC03eiBtLTUxMTcgLTEzCmM0OSAtNDkgNTIgLTEwNSA3IC0xNTcgLTE4IC0yMSAtMzUgLTI4IC03NSAtMzIgLTQ5IC00IC01NCAtMiAtODcgMzEgLTM5IDM5Ci00NSA3OCAtMjAgMTI3IDIxIDQxIDUzIDYwIDEwMyA2MCAzNSAwIDQ5IC02IDcyIC0yOXogbTQzNzggLTQwNyBjMzMgLTIzIDI3Ci02MCAtMjAgLTEzNCAtNTMgLTgyIC0xMzggLTI0MCAtMTI5IC0yNDAgMyAwIDM4IDEzIDc3IDI5IDk1IDM5IDEyMyA0MiAxNDAKMTUgMTMgLTE4IDEyIC0yNCAtNyAtNDcgLTExIC0xNSAtNTYgLTQ0IC0xMDAgLTY0IC00MyAtMjEgLTc5IC00MSAtNzkgLTQ1IDAKLTMgMjkgLTE2IDY1IC0yOCAzNiAtMTIgNjcgLTI2IDcwIC0zMCAzIC01IDMgLTIxIC0xIC0zNSAtOCAtMzIgLTI2IC0zMiAtMTI3CjAgLTEyNSA0MCAtMTI2IDM5IC0xNjcgLTYxIC0zNyAtOTAgLTYwIC0xMTUgLTg3IC05MiAtMTIgMTAgLTE0IDI2IC0xMCA3OCA0CjM2IDkgNzUgMTMgODcgNSAxOCAzIDIxIC0xNSAxNiAtMTIgLTMgLTIxIC05IC0yMSAtMTMgMCAtMTQgLTE3OSAtOTkgLTIyMwotMTA1IC0xMDUgLTE2IC0xNzggNTYgLTE0NiAxNDMgMTEgMzAgLTMgMjggLTM4IC00IC0xNSAtMTQgLTM2IC0zMiAtNDYgLTM5Ci0xNiAtMTEgLTE3IC0xNiAtNSAtMzQgMjggLTQ2IC0zNSAtODIgLTY4IC0zOCBsLTE4IDIzIC00MSAtMjIgYy05MiAtNTAgLTE1NQotMzcgLTE5MyA0MiAtMTIgMjQgLTIyIDUxIC0yMiA2MCAwIDYwIDE0MyAyMTIgMjUyIDI2OCA5MCA0NiAxMjAgNDcgMTQ3IDIgMjkKLTQ2IDI2IC03OSAtOSAtMTE5IC0zOSAtNDUgLTE2NSAtMTA3IC0yMjAgLTExMCAtMzIgLTEgLTQ2IC03IC01OCAtMjQgLTMwCi00NyAtMTEgLTQ0IDE4MyAzMSAxMDMgNDAgMTY4IDU3IDE3NSA0NSA0IC01IDE1IDAgMjYgMTIgMzIgMzYgMTg3IDE0MiAyMjQKMTUzIDE5IDYgNDMgMjEgNTMgMzMgMjIgMjcgNDYgMjkgODkgNyAyOCAtMTQgMzAgLTE5IDI1IC01NiAtNyAtNDkgLTU1IC0xNDgKLTgwIC0xNjIgLTE1IC05IC0yMyAtNSAtNDcgMjEgbC0yOCAzMSAtNTQgLTM1IGMtNjMgLTQxIC05MiAtNjcgLTEyMSAtMTA3CmwtMjEgLTI5IDQ1IDYgYzczIDExIDI1MiA2OSAyNzUgODkgMTEgMTAgMzUgNTQgNTMgOTcgMTggNDQgNTcgMTIxIDg3IDE3MSAzMAo1MCA1NCA5NCA1NCA5NyAwIDMgMTEgMjEgMjUgMzkgMTQgMTggMjUgMzYgMjUgNDAgMCAxNSA0NCA1NCA2MCA1NCA4IDAgMjYgLTcKMzggLTE2eiBtLTEyMDggLTI0IGMxMiAtMTIgMTggLTI0IDE2IC0yOSAtMyAtNCAzMCAtMTEgNzMgLTE0IDIzMyAtMTYgMjE3Ci0xNDEgLTM3IC0yODggLTIyIC0xMyAtMzIgLTI1IC0yOCAtMzUgMyAtOCAtNCAtMjQgLTE1IC0zNSAtMTkgLTE5IC0yMiAtMTkKLTQ0IC01IC0yMyAxNSAtMjkgMTQgLTEyNyAtNDEgLTU3IC0zMSAtMTM0IC03NSAtMTczIC05OCAtMTA0IC02MyAtMjU1IC0xMzgKLTI2MiAtMTMxIC0zIDMgLTEzIDAgLTIxIC02IC04IC03IC0yMCAtMTMgLTI4IC0xNCAtNyAtMSAtMjcgLTEyIC00NCAtMjQgLTI0Ci0xNyAtMzAgLTE4IC0zMCAtNiAwIDMxIDEyNyAxNTggMjI0IDIyMyAzNCAyMyA3MCA1MyA4MCA2NyA5IDE0IDI2IDI2IDM3IDI2CjEyIDAgNTAgMjAgODUgNDUgMzQgMjUgNjcgNDUgNzIgNDUgNSAwIDIwIDkgMzMgMTkgMTQgMTAgMzggMjcgNTUgMzcgMzYgMjIKNzQgNDcgMTI5IDg4IGw0MCAyOCAtOTkgLTYgYy05NiAtNyAtMjA3IC0yNCAtMzEzIC00NyBsLTUxIC0xMiAtMzcgLTkxIGMtNTUKLTEzNCAtMTA0IC0yMzkgLTEyMiAtMjU4IC0xOSAtMjIgLTUxIC0yMyAtNzcgLTMgLTE4IDE0IC0xOSAyMCAtOCA4MCA3IDM1IDE1CjcyIDE5IDgxIDUgMTMgMiAxNSAtMTggOSAtMzkgLTEyIC01NCAtMzMgLTU0IC03OCAwIC00MiAwIC00MiAtMzcgLTQyIC0yMiAwCi01NCAtMTAgLTc3IC0yNSAtMzMgLTIwIC0zOSAtMjggLTM1IC00NyAxMSAtNDIgLTkgLTUyIC05NCAtNDcgLTQyIDMgLTc5IDkKLTgyIDE0IC0zIDUgLTM3IC01OCAtNzUgLTE0MCAtMzkgLTgyIC03NCAtMTQ5IC04MCAtMTUwIC0yOCAwIC0zOCAyMCAtMzkgNzcKMCA2OCAzNyAxNzMgMTEzIDMyNCBsNDkgOTUgLTI5IC00IGMtMTYgLTIgLTI5IC04IC0yOSAtMTQgMCAtMzYgLTI1NCAtMTk3Ci0zMzcgLTIxNCAtMTkgLTQgLTQyIDAgLTYyIDEwIC0zNCAxOCAtNzEgODEgLTcxIDEyMSAwIDMxIC03IDMxIC0zOSAxIC0zMwotMzIgLTE3NyAtMTExIC0yMjkgLTEyNyAtNTcgLTE3IC05NCAwIC0xMjcgNTggLTMzIDU5IC0zMiA5MCA2IDE0NiA2MyA5NiAyNDQKMjI3IDMxMiAyMjcgMzMgMCA3NyAtNTIgNzcgLTkwIDAgLTI5IC00OSAtOTEgLTgwIC0xMDIgLTEyIC01IC0xMiAtOCA1IC0yMQoxNyAtMTMgMjUgLTEzIDY5IDAgMzcgMTEgNjkgMzIgMTIyIDgyIDgwIDc1IDE4NiAxMzQgMjMwIDEyOSAzMSAtMyA3NCAtNTYgNzQKLTg5IDAgLTU1IC0xNzAgLTE2OSAtMjUxIC0xNjkgLTI5IDAgLTQyIC02IC01OSAtMjcgLTE4IC0yMyAtMTkgLTI5IC03IC0zMQoxMyAtMyAxNTQgNDYgMjQyIDgzIDE3IDcgNDkgMTggNzIgMjQgNDAgMTEgNDIgMTMgMzggNDYgLTUgMzIgLTMgMzUgNTAgNTkgMjkKMTQgNTggMjYgNjMgMjYgNSAwIDE1IDYgMjEgMTQgMTUgMTcgMTYxIDMxIDIyNiAyMSAyOCAtNCA1OSAtMTcgNzggLTM0IDE4Ci0xNSA0NCAtMzIgNTggLTM4IDI0IC0xMCAyNiAtOSA0MSAzMiAxOCA0OCAxMiA1NyAtMzQgNDggLTE1IC0zIC0zMSAyIC00MiAxMgotMzAgMzEgLTE1IDQ5IDYyIDc0IDU1IDE4IDcyIDI4IDY3IDM5IC03IDE5IDIxIDYyIDQxIDYyIDggMCAyNyAtMTIgNDEgLTI2CjMwIC0zMCA3MyAtMjcgNzMgNiAwIDE3IDcgMjAgNDQgMjAgMjYgMCA0NiAtNSA0OCAtMTIgNiAtMTggNTggNiA1OCAyNiAwIDggOQoxNyAyMCAyMSAyMSA3IDYwIC0xMCA2MCAtMjYgMCAtNiAxNSAtOCAzOCAtNCA2NiAxMSA4MiAxNSA4MCAyMyAtNCAxNiAxNCA1MgoyOCA1MiA4IDAgMjMgLTkgMzQgLTIweiBtLTE4NDMgLTYzIGM3MiAtMzkgNjYgLTEwOCAtMTcgLTE3OSAtNDcgLTQwIC0yNDMKLTE1NSAtNDI1IC0yNDkgLTQ0IC0yMyAtODcgLTQ3IC05NSAtNTQgLTggLTcgLTQyIC0yNyAtNzUgLTQ1IC0zMyAtMTcgLTY4Ci00MCAtNzggLTUxIC0xMCAtMTAgLTI5IC0xOSAtNDIgLTE5IC0xMyAwIC0yNyAtNCAtMzAgLTEwIC0zIC01IC0xNiAtMTAgLTI5Ci0xMCAtMTIgMCAtMjcgLTUgLTM0IC0xMiAtNyAtNyAtMTIgLTggLTEyIC00IDAgNCAtMTYgLTIgLTM2IC0xNCAtMzcgLTI0IC01NQotMjAgLTM4IDggOCAxMiA4IDIyIDAgMzUgLTE4IDI4IDUgNTIgNDcgNTAgMjUgLTIgNDAgNCA1NiAyMSBsMjEgMjMgLTI5IC01CmMtNjMgLTkgLTc0IDM1IC00MSAxNTkgMTEgNDEgMjAgODYgMjAgMTAwIDAgMTUgNyAzMiAxNSAzOSAyNSAyMCAxMiAzNSAtMzEKMzUgLTMzIDAgLTQwIDQgLTQ4IDI4IC0xMyAzNSAtNSA0MCA4NiA2MiAzNyAxMCA3MiAyMyA3OSAzMSA2IDggMzAgMTQgNTMgMTQKMjIgMCA1OSA1IDgxIDExIDIyIDcgMTA1IDIyIDE4NSAzNCAxODEgMjggMzY4IDI5IDQxNyAyeiBtOTIxIC04NzggYzIgLTkgLTMxCi02MSAtNzMgLTExNSAtMTEyIC0xNDUgLTE4OSAtMjY1IC0xODcgLTI5MCAyIC0yOSAtMjIgLTQ4IC01MiAtNDAgLTI3IDcgLTM3CjI1IC0yOSA1NSA0IDE2IDEzIDIxIDM5IDIxIDI5IDAgMzQgNCAzNCAyMyAwIDEyIDE4IDU0IDM5IDk0IGwzOCA3MiAtMjQgNgpjLTEzIDMgLTIzIDEzIC0yMyAyMyAwIDE5IDM1IDk5IDUxIDExOCAxNCAxOCAzOSA2IDM5IC0xOCAwIC0xMyA2IC0xOCAxOCAtMTYKMTEgMiAxNyAxMyAxNyAyOSAwIDQxIDIxIDU4IDY4IDU2IDI5IC0xIDQzIC03IDQ1IC0xOHogbTE3MSAtOCBjOCAtMTQgNiAtMzMKLTQgLTY3IC04IC0yNiAtMTMgLTQ5IC0xMSAtNTEgMSAtMiAxNCAxNCAyNyAzNCAxMyAyMSAzOSA0OCA1OCA2MCAzMiAyMiAzNQoyMiA1MiA3IDEwIC05IDE2IC0yMiAxMiAtMjggLTQgLTYgMTQgNiAzOSAyNyA4MSA2NSAxMTIgNDQgNzcgLTUxIC0xMiAtMzEKLTI2IC03OCAtMzEgLTEwNSAtMTUgLTY2IC0zOCAtNDcgLTM4IDMxIGwwIDU2IC0zNCAtMzMgYy0zNiAtMzUgLTY2IC0zNyAtNjYKLTQgMCAxMiAtMTIgNSAtNDEgLTI2IC0zMCAtMzEgLTQ0IC00MCAtNTIgLTMyIC0xNyAxNyAtMjQgMTMgLTMxIC0xNCAtNiAtMjIKLTkgLTI0IC0yNiAtMTUgLTEyIDYgLTIwIDIxIC0yMCAzNSAwIDE0IC0yIDI1IC01IDI1IC0yIDAgLTIzIC0xMyAtNDcgLTI5Ci00OCAtMzMgLTcyIC0yOSAtODkgMTcgLTE1IDM5IC00IDY0IDQ3IDExMiAzOCAzNSA1MSA0MSA3OSAzOCAyNCAtMyAzNiAxIDQ0CjE0IDE1IDI0IDQ4IDIzIDYwIC0xeiBtMjc4MSAtMTExIGMyNiAtMjYgMjggLTExNCAzIC0xNDIgLTIwIC0yMiAtNjEgLTIzIC04NQotMSAtMjQgMjIgLTI1IDExOCAtMSAxNDUgMjEgMjQgNTggMjMgODMgLTJ6IG0tMjIzNiAtMTAyMSBjNDYgLTM2IDMyIC0xMDgKLTI0IC0xMjggLTc4IC0yNyAtMTM1IDY1IC03OCAxMjYgMjcgMjkgNjcgMzAgMTAyIDJ6IG0xMTYxIC00IGM0MyAtNDIgMjgKLTEwMyAtMjkgLTEyNSAtNzQgLTI4IC0xMzIgODAgLTcwIDEyOSAzNSAyOCA2OSAyNiA5OSAtNHogbS03ODAgLTE1MCBjMzUgLTM0CjM0IC04NiAtMiAtMTE1IC03NiAtNjAgLTE2NyA1MCAtOTcgMTE1IDM0IDMyIDY4IDMyIDk5IDB6IG0tMjMwIC0xMDkgYzgyIC0zNQo5OSAtMTQxIDMxIC0yMDMgLTQzIC0zOSAtOTMgLTQ0IC0xNDQgLTEzIC0zMiAyMCAtNjIgNzEgLTYyIDEwNyAwIDMzIDM2IDg2CjcxIDEwNSA0MSAyMiA1OSAyMiAxMDQgNHogbS0yMzMwIC04NTYgYy0zIC01IC00OCAtMTAgLTk4IC0xMCAtODcgLTEgLTkwIC0yCi02NSAtMTYgNTMgLTI4IDY0IC04NiAyNCAtMTI0IC0xNCAtMTIgLTM3IC0yMiAtNTEgLTIyIC0zNyAwIC03NSAzOCAtNzUgNzcgMAozMSAyNyA2NiA2MCA3OCA4IDMgLTQwIDYgLTEwNyA2IC02OSAxIC0xMjQgNSAtMTI4IDExIC00IDcgNzIgMTAgMjIwIDEwIDE0OAowIDIyNCAtMyAyMjAgLTEweiBtMjQwIC0xOTUgYzQwIC0zOSAyOSAtMTA2IC0yMCAtMTI1IC01MCAtMTkgLTEwNSAyMyAtMTA1CjgxIDAgMjggNDQgNjkgNzUgNjkgMTQgMCAzNyAtMTEgNTAgLTI1eiBtMjMxOSA0IGM0NiAtMzYgMjggLTExOSAtMjkgLTEzMwotODIgLTIxIC0xMzIgOTggLTU3IDEzOCAzNyAyMSA1NSAyMCA4NiAtNXogbS0yNTU0IC0xMTQgYzc5IC0yMiAxMDUgLTEzNyA0NAotMTk4IC01MiAtNTIgLTE0NCAtNDAgLTE4NCAyNSAtNDMgNzEgLTEzIDE1NCA2NSAxNzkgMjAgNyAzMSA2IDc1IC02eiBtMTM5NQotMTA1MCBjNTAgLTQ5IDIwIC0xMjUgLTQ5IC0xMjUgLTM5IDAgLTYzIDE5IC03MiA1NiAtMTggNzMgNjkgMTIyIDEyMSA2OXoiLz4KPHBhdGggZD0iTTI1NTcgNjM3OCBjLTkgLTcgLTMyIC00OSAtNTIgLTkzIC0yMCAtNDQgLTQzIC05MyAtNTIgLTEwOSAtMjYgLTQ3CjExMyA3NyAxNzAgMTUxIGw0OCA2MyAtNDkgMCBjLTI2IDAgLTU2IC02IC02NSAtMTJ6Ii8+CjxwYXRoIGQ9Ik0xMzQwIDY1ODMgYy01OCAtNiAtMTYwIC0yMiAtMjQzIC00MCBsLTc5IC0xNiAtMjQgLTU1IGMtMjkgLTY2IC0yOQotNjUgLTEgLTc3IDEyIC02IDIzIC0yMCAyNSAtMzIgNCAtMjggLTMwIC00OCAtNTcgLTM0IC0xNiA5IC0yMSA0IC0zOSAtMzcKLTE0IC0zMyAtMTcgLTUwIC0xMCAtNTkgMTIgLTE1IDkgLTE3IDE4MiAxMDIgNDggMzMgMTEyIDc0IDE0MiA5MiA3MSA0MiAyMjQKMTQ0IDIzMCAxNTUgNSA4IC01NSA4IC0xMjYgMXoiLz4KPHBhdGggZD0iTTIxIDcyMTkgYy04IC0yMyAtMTEgLTMzMCAtMTEgLTEwMjUgMCAtODU3IDIgLTk5NCAxNCAtOTk0IDEzIDAgMTUKMTQxIDE2IDEwMjUgMCA1NjQgLTIgMTAyNSAtNCAxMDI1IC0yIDAgLTkgLTE0IC0xNSAtMzF6Ii8+CjxwYXRoIGQ9Ik01MjUwIDQxNDkgYy0xMDMgLTE2IC0xMjkgLTI0IC0yMTYgLTY1IC04OCAtNDIgLTI1MiAtMTU5IC0yNDAgLTE3Mgo2IC02IDI1IC03IDE1OSAtMTAgbDY3IC0yIDAgLTYxIGMwIC01NSAyIC02MCAxOCAtNTMgOSA1IDY0IDkgMTIyIDkgMTE3IC0xCjE0OCAtMTEgMjE5IC03MiA2MCAtNTEgODMgLTEwMiA4NCAtMTgzIDAgLTUyIC01IC03OSAtMjQgLTExNiAtMzMgLTY2IC02NQotODggLTExNyAtNzkgLTcxIDEyIC03NyAyMSAtNzcgMTI3IC0xIDUxIC00IDEwNCAtOSAxMTcgLTggMjIgLTEyIDIzIC02MSAxOAotNjkgLTcgLTkxIC0xOSAtMTE1IC02NiAtNDMgLTg1IC0zMyAtMjA0IDIzIC0yODggNTAgLTczIDUxIC03MyAxNTMgLTExIDExMQo2OCAzMTEgMTc4IDMyNCAxNzggNiAwIDEwIDEzMCAxMCAzNTAgbDAgMzQ5IC00MiAxMSBjLTI0IDYgLTUyIDE0IC02MyAxNyAtMjkKOCAtMTY0IDEwIC0yMTUgMnoiLz4KPHBhdGggZD0iTTQ3NzQgMzg3MiBjLTI1IC0yIC00MiAtMTYgLTgxIC02NSAtNTUgLTY5IC0xMDYgLTE1MSAtMTEwIC0xODAgLTIKLTEwIC0xMCAtMjUgLTE4IC0zMyAtOCAtOSAtMTUgLTIyIC0xNSAtMzAgMCAtMTEgMjMgLTE0IDEyNSAtMTQgbDEyNSAwIDIxIDQxCmMyNSA1MCA5OSAxMzEgMTQ1IDE2MCA0NSAyNyA0MyAzOCAtNiAzNiAtNDYgLTEgLTY1IDEyIC01NSA0MiA1IDE2IDE1IDIxIDQzCjIxIDMzIDEgMzUgMiAxNyAxMyAtMTkgMTEgLTExOSAxNiAtMTkxIDl6Ii8+CjxwYXRoIGQ9Ik0zNzIxIDM3OTMgYzAgLTE2IDMgLTIyIDYgLTE1IDMgNyAyNSAxMiA1OSAxMiA1MSAwIDU0IC0xIDU0IC0yNSAwCi0yNCAtMyAtMjUgLTU0IC0yNSAtMzQgMCAtNTYgNSAtNTkgMTMgLTMgNiAtNSAtOCAtNSAtMzMgMCAtMjUgMiAtMzkgNSAtMzIgMwo3IDI1IDEyIDU5IDEyIDUxIDAgNTQgLTEgNTQgLTI1IDAgLTI0IC0zIC0yNSAtNTQgLTI1IC0zNCAwIC01NiA1IC01OSAxMyAtMwo2IC02IC0zIC02IC0yMCBsLTEgLTMzIDEwMyAyIGM1NiAxIDg1IDMgNjUgNSBsLTM4IDQgMCAxMDAgMCA5OSAtNjUgMCBjLTY0IDAKLTY1IDAgLTY0IC0yN3oiLz4KPHBhdGggZD0iTTI4OTQgMzU3MSBjLTE0IC0zMSAtNDcgLTk5IC03MyAtMTUxIC00NiAtOTIgLTQ3IC05NiAtMzMgLTEzMCAyMQotNTMgMTMxIC0xNTQgMTg3IC0xNzQgNDQgLTE0IDEwMCAtMjMgNjggLTkgLTE5IDcgLTE2IDQ4IDUgNjYgNDEgMzcgMTAxIDEgODIKLTQ5IC04IC0yMCAtNiAtMjQgOSAtMjQgMjMgMCA5NSA1MiAxMTcgODUgMjMgMzUgMzYgMTAzIDI5IDE0NyAtNiAzNCAtOSAzNwotMzkgMzYgLTE3IC0xIC00MCA0IC01MSAxMCAtMTkgMTAgLTIwIDcgLTE3IC00OSA0IC01NyAyIC02MSAtMzIgLTk1IC0zNSAtMzUKLTM5IC0zNiAtOTUgLTMyIC03OCA2IC0xMzIgNDEgLTE2NiAxMDggLTUwIDk4IC0yMyAxODUgNjUgMjA4IDYwIDE1IDExMiAtMgoxNjUgLTU0IDQ0IC00MyA0NSAtNDMgNDUgLTE3IDAgMTUgNyAzNCAxNiA0NCAyMCAyMyA2IDQ3IC01MCA4MSAtNTEgMzIgLTEwMgo0OSAtMTYxIDUyIGwtNDUgMyAtMjYgLTU2eiIvPgo8cGF0aCBkPSJNNDUxNSAzNDczIGMtMjYgLTkwIC00NiAtMjQzIC0zMSAtMjQzIDEgMCAxNyA1IDM0IDExIDk4IDM0IDE4MiAtODUKMTI2IC0xNzkgLTIyIC0zOCAtODQgLTY2IC0xMjYgLTU3IGwtMjkgNyA3IC05OSBjMyAtNTQgNyAtOTkgOCAtMTAwIDMgLTQgMTI0CjI2IDE2MiA0MCAyMyA4IDcwIDM4IDEwNiA2NyBsNjQgNTEgLTMyIDY0IGMtMTggMzUgLTM4IDkwIC00NSAxMjEgLTcgMzMgLTIzCjY3IC0zNiA4MCAtMzAgMzEgLTMwIDc0IDIgMTEyIDE0IDE3IDI1IDM3IDI1IDQ1IDAgOCA5IDQzIDE5IDc2IGwxOSA2MSAtMTI4CjAgLTEyOSAwIC0xNiAtNTd6Ii8+CjxwYXRoIGQ9Ik0yMzY2IDI5ODcgbC0xNDggLTcyIDUgLTYwIGMyIC0zNCAxNCAtNzkgMjYgLTEwMyAzNCAtNjcgMTIxIC0xNDYKMTg4IC0xNzEgMTA5IC00MCAxODUgLTI5IDI0OSAzNCAxMDAgMTAwIDgxIDI0NiAtNDggMzc1IC0zOCAzOSAtODcgNzAgLTEwOAo3MCAtOCAwIC04MiAtMzMgLTE2NCAtNzN6IG0xNzYgLTM2IGMyNyAtMTggNTcgLTQ4IDczIC03NiAyMyAtMzkgMjcgLTU0IDIzCi0xMDIgLTQgLTQ1IC0xMCAtNjEgLTMyIC03OSAtNzcgLTY3IC0yMTMgLTIwIC0yNjUgOTEgLTMyIDY5IC0yOCAxMDcgMTcgMTU1CjM1IDM2IDQ0IDQwIDg4IDQwIDM4IDAgNjEgLTcgOTYgLTI5eiIvPgo8cGF0aCBkPSJNMjU2MSAxNDczIGMwIC0xNiAzIC0yMiA2IC0xNSAzIDcgMjUgMTIgNTkgMTIgNTEgMCA1NCAtMSA1NCAtMjUgMAotMjQgLTMgLTI1IC01NCAtMjUgLTM0IDAgLTU2IDUgLTU5IDEzIC0zIDYgLTUgLTggLTUgLTMzIDAgLTI1IDIgLTM5IDUgLTMyIDMKNyAyNSAxMiA1OSAxMiA1MSAwIDU0IC0xIDU0IC0yNSAwIC0yMCAtNSAtMjUgLTI3IC0yNiAtNTAgLTIgLTc4IDMgLTg1IDE1IC01CjcgLTggNyAtOCAwIDAgLTYgMTAgLTIwIDIzIC0zMiAyMSAtMTkgMzQgLTIyIDEyMCAtMjIgNTMgMCA5NyA0IDk3IDkgMCA1IC0xNwo5IC0zNyA5IC03OSAxIC03MyAtOCAtNzMgOTcgbDAgOTUgLTY1IDAgYy02NCAwIC02NSAwIC02NCAtMjd6Ii8+CjxwYXRoIGQ9Ik0zNDUwIDQ4NiBjLTQxIC0yMyAtOTcgLTU1IC0xMjUgLTcwIC0yNyAtMTUgLTUzIC0zMSAtNTcgLTM1IC00IC0zCjQgLTQyIDE5IC04NiAyMCAtNjIgMjYgLTEwMSAyNyAtMTcyIGwxIC05MyAxNTEgMCAxNTIgMCA2IDMxIGMxNCA3MCAwIDIxOQotMjkgMzIwIC0xNyA1OSAtNTYgMTQ5IC02NCAxNDggLTMgLTEgLTQwIC0yMCAtODEgLTQzeiIvPgo8cGF0aCBkPSJNNDcwNSA1MDcgYy0yMSAtNzIgLTc1IC0yNzYgLTc1IC0yODcgMCAtOSAzMyAtMzIgNzYgLTU0IDQxIC0yMSA5OQotNjEgMTI5IC04NyBsNTMgLTQ5IDE2NiAwIGM5MSAwIDE2NiAzIDE2NiA3IDAgMyAtMjEgNDUgLTQ3IDkyIC02MiAxMTEgLTE5NwoyNTAgLTMwMSAzMDkgLTEwNyA2MSAtMTYyIDg0IC0xNjcgNjl6Ii8+CjxwYXRoIGQ9Ik01MCAyODMgYzEgLTEzOSAzMiAtMjAwIDEyMiAtMjM4IDQ4IC0xOSAyNjUgLTIyIDIzNCAtMiAtMTAgNyAtMzUKMjcgLTU1IDQ0IC0zMyAyOSAtNDAgMzIgLTgyIDI3IC04NSAtMTEgLTE0NyA0NyAtMTM2IDEyNyA0IDMzIDAgNDMgLTM5IDg5CmwtNDQgNTIgMCAtOTl6Ii8+CjxwYXRoIGQ9Ik0yNzk1IDE4OSBjLTIyIC00IC0xNTggLTMzIC0zMDIgLTYzIC0xNDQgLTMwIC0yNzYgLTYzIC0yOTUgLTczIC0zMwotMTggLTMzIC0xOCAxNjYgLTIxIGwxOTkgLTIgMjcgMjUgYzIzIDIyIDM1IDI1IDkzIDI1IDY1IDAgNjcgLTEgNjcgLTI1IGwwCi0yNSAxMjAgMCAxMjAgMCAwIDM1IGMwIDEwOCAtNjggMTUxIC0xOTUgMTI0eiIvPgo8L2c+Cjwvc3ZnPgo=\" /></div>\n"
      "</body>\n"
      "</html>\n";


#include "lwip/sys.h"
#include "lwip/netdb.h"
#include "lwip/api.h"


static void http_server_netconn_serve(struct netconn *conn)
{
  struct netbuf *inbuf;
  char *buf;
  u16_t buflen;
  err_t err;

  /* Read the data from the port, blocking if nothing yet there.
   We assume the request (the part we care about) is in one netbuf */
  err = netconn_recv(conn, &inbuf);

  if (err == ERR_OK) {
    netbuf_data(inbuf, (void**)&buf, &buflen);

    // strncpy(_mBuffer, buf, buflen);

    /* Is this an HTTP GET command? (only check the first 5 chars, since
    there are other formats for GET, and we're keeping it very simple )*/
    printf("buffer = %s \n", buf);
    if (buflen>=5 &&
        buf[0]=='G' &&
        buf[1]=='E' &&
        buf[2]=='T' &&
        buf[3]==' ' &&
        buf[4]=='/' ) {
          printf("buf[5] = %c\n", buf[5]);
      /* Send the HTML header
             * subtract 1 from the size, since we dont send the \0 in the string
             * NETCONN_NOCOPY: our data is const static, so no need to copy it
       */

      netconn_write(conn, http_html_hdr, sizeof(http_html_hdr)-1, NETCONN_NOCOPY);

      if(buf[5]=='h') {
        /* Send our HTML page */
        netconn_write(conn, http_index_hml, sizeof(http_index_hml)-1, NETCONN_NOCOPY);
      }
      else if(buf[5]=='l') {
        /* Send our HTML page */
        netconn_write(conn, http_index_hml, sizeof(http_index_hml)-1, NETCONN_NOCOPY);
      }
      else if(buf[5]=='j') {
    	  netconn_write(conn, json_unformatted, strlen(json_unformatted), NETCONN_NOCOPY);
      }
      else {
          netconn_write(conn, http_index_hml, sizeof(http_index_hml)-1, NETCONN_NOCOPY);
      }
    }

  }
  /* Close the connection (server closes in HTTP) */
  netconn_close(conn);

  /* Delete the buffer (netconn_recv gives us ownership,
   so we have to make sure to deallocate the buffer) */
  netbuf_delete(inbuf);
}

void http_server(void *pvParameters)
{
  ESP_LOGI(LAYOUT_TAG, "Starting webserver");
  struct netconn *conn, *newconn;
  err_t err;
  conn = netconn_new(NETCONN_TCP);
  netconn_bind(conn, NULL, 80);
  netconn_listen(conn);
  do {
    do_ping();
     err = netconn_accept(conn, &newconn);
     if (err == ERR_OK) {
       http_server_netconn_serve(newconn);
       netconn_delete(newconn);
     }
   } while(err == ERR_OK);
   netconn_close(conn);
   netconn_delete(conn);
   ESP_LOGI(LAYOUT_TAG, "Webserver closed");

}


